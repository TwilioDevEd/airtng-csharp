<!DOCTYPE html><html><head><title>Workflow Automation</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Workflow Automation"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Workflow Automation</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Increase your rate of response by automating the workflows that are key to your business. In this tutorial, learn how to build a ready-for-scale automated SMS workflow, for a vacation rental company.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Voice Conference and Broadcast" class="chapter"><div data-title="Introduction" data-file="AirTNG.Web/Domain/Reservations/TwilioMessageSender.cs" data-highlight="20-25" class="step"><h2 id="workflow-automation-vacation-rental-example">Workflow Automation - Vacation Rental example</h2>
<p><img src="http://howtodocs.s3.amazonaws.com/airtng-screen.png" alt="Airtng"></p>
<p>At its core this use-case is about enabling your service providers
(agents, hosts, customer service reps, administrators, etc) to better
serve their customers. To illustrate a very real-world example of this
use-case we will implement a webapp for finding and booking vacation
properties--we&#39;re calling it Airtng. Here&#39;s how it works:</p>
<ol>
<li>A host creates a vacation property</li>
<li>A guest requests a reservation on that property</li>
<li>The host receives an SMS notifying them of the recent reservation request. The host can either Accept or Reject the reservation.</li>
<li>The guest is notified that their reservation was either accepted or rejected.</li>
</ol>
<h2 id="building-blocks">Building Blocks</h2>
<p>We&#39;ll be using the Twilio REST API to implement this use-case:</p>
<ul>
<li><a href="//www.twilio.com/docs/api/rest/sending-messages">Messages Resource</a>: We
will use Twilio directly to send our users messages at important
junctures.</li>
</ul>
<p>Let&#39;s get started! Click the right arrow to move on to the next step of
the tutorial.</p>
</div><div data-title="Authentication" data-file="AirTNG.Web/Models/IdentityModels.cs" data-highlight="10-24" class="step"><h2 id="authentication">Authentication</h2>
<p>For this use case to work we have to handle authentication. We will
rely on <em>ASP.NET Identity</em> for this purpose.</p>
<p>Each <code>User</code> will need to have a <code>phone_number</code> that will be required to
send sms notifications.</p>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.asp.net/identity/overview/getting-started/introduction-to-aspnet-identity">Introduction to ASP.NET Identity</a></li>
</ul>
</div><div data-title="Vacation Property" data-file="AirTNG.Web/Models/VacationProperty.cs" data-highlight="6-15" class="step"><h2 id="vacation-property">Vacation Property</h2>
<p>The first thing we need to do is create the property listings.</p>
<p>The <code>VacationProperty</code> belongs to the <code>User</code> who created it (we&#39;ll call
this user the <em>host</em> from this point on) and contains only two properties: a
<code>Description</code> and an <code>ImageUrl</code>.</p>
<p>A <code>VacationProperty</code> can have many <code>Reservations</code>.</p>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//msdn.microsoft.com/en-us/data/jj193542.aspx">Entity Framework Code First to a New Database</a></li>
</ul>
</div><div data-title="Reservation" data-file="AirTNG.Web/Models/Reservation.cs" data-highlight="6-17" class="step"><h2 id="reservation">Reservation</h2>
<p>The <code>Reservation</code> model is at the center of the workflow for this
application.</p>
<p>It is responsible for keeping track of:</p>
<ul>
<li>The <code>VacationProperty</code> it is associated with.</li>
<li>The <code>User</code> who owns that vacation property (the host). Through this
property the user will have access to its phone number.</li>
<li>The <code>Status</code> of the reservation</li>
</ul>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//msdn.microsoft.com/en-us/data/spx">Entity Framework Code First to a New Database</a></li>
<li><a href="//msdn.microsoft.com/en-us/data/jj713564.aspx">Relationships and Navigation Properties</a></li>
</ul>
</div><div data-title="Reservation Creation" data-file="AirTNG.Web/Controllers/ReservationsController.cs" data-highlight="55-79" class="step"><h2 id="reservation-creation">Reservation Creation</h2>
<p>The reservation creation form holds only one field, the message that will
be sent to the <em>host</em> when one of his properties is reserved. The rest
of the information needed to create a reservation is taken from the
vacation property itself.</p>
<p>A reservation is created with a default status
<code>ReservationStatus.Pending</code>. When the <em>host</em> replies with an <code>accept</code>
or <code>reject</code> response the application knows which reservation the <em>host</em>
is referring to.</p>
<p>In the next step we&#39;ll take a look at how the SMS notification is sent to
the host when a reservation is created.</p>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.asp.net/mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4">Using Asynchronous Methods in ASP.NET MVC 4</a></li>
</ul>
</div><div data-title="Notifying The Host" data-file="AirTNG.Web/Domain/Reservations/TwilioMessageSender.cs" data-highlight="20-25" class="step"><h2 id="notifying-the-host">Notifying The Host</h2>
<p>When a reservation is created, we want to notify the owner of the
property that someone has made a reservation.</p>
<p>This is where we use <a href="//www.twilio.com/docs/csharp/install">Twilio C# Helper
Library</a> to send a SMS message to
the <em>host</em>, using our <a href="//www.twilio.com/user/account/phone-numbers/incoming">Twilio phone
number</a>.</p>
<p>As you can see, sending SMS messages using Twilio is made in only a few lines of
code. After that we have to wait for the host to send an SMS
response accepting or rejecting the reservation. That way we can notify the
guest and host that the reservation information is updated accordingly.</p>
<p>The next step shows us how to handle and configure the host&#39;s SMS response.</p>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/rest">Twilio Rest API</a></li>
<li><a href="//www.twilio.com/docs/quickstart/csharp/sms/sending-via-rest">SMS and MMS Quickstart Tutorial</a></li>
</ul>
</div><div data-title="Handling Incoming Messages" data-file="AirTNG.Web/Controllers/ReservationsController.cs" data-highlight="81-110" class="step"><h2 id="handling-incoming-messages">Handling Incoming Messages</h2>
<p>Let&#39;s take a closer look at the <code>Reservations/Handle</code> controller. This controller
handles our incoming Twilio request and does three things:</p>
<ol>
<li>Checks for the guest&#39;s pending reservation.</li>
<li>Updates the status of the reservation.</li>
<li>Responds to the host and sends notification to the guest.</li>
</ol>
</div><div data-title="Incoming Twilio Request" data-file="AirTNG.Web/Controllers/ReservationsController.cs" data-highlight="81-111" class="step"><h2 id="incoming-twilio-request">Incoming Twilio Request</h2>
<p>In your <a href="//www.twilio.com/user/account/phone-numbers/incoming">Twilio
number</a> you must
setup the sms web hook to call your application&#39;s end point in the route
<code>Reservations/Handle</code>. Remember to expose your development machine to
the outside world using <a href="//ngrok.com/">ngrok</a>. The url for the sms
web hook on your number should look like this:</p>
<pre><code>http://&lt;subdomain&gt;.ngrok.io/Reservations/Handle
</code></pre><p>An incoming request from Twilio comes with some helpful
<a href="//www.twilio.com/docs/api/twiml/sms/twilio_request#request-parameters">parameters</a>.
These include the <code>from</code> phone number and the message <code>body</code>.</p>
<p>We&#39;ll use the <code>from</code> parameter to look for the host and check if he/she has any
pending reservations. If he/she does, we&#39;ll use the message body to check if
he/she accepted or rejected the reservation.</p>
<p>In the last step, we&#39;ll use <a href="//github.com/twilio/twilio-csharp/wiki/Twilio.Api#smsmessage-sendmessage-from-to-body">Twilio&#39;s
TwiML</a>
as a response to Twilio&#39;s server instructing it to send an SMS message to
the <em>guest</em>.</p>
</div><div data-title="TwiML Response" data-file="AirTNG.Web/Controllers/ReservationsController.cs" data-highlight="112-118" class="step"><h2 id="twiml-response">TwiML Response</h2>
<p>After updating the reservation status, we must notify the <em>host</em> that he/she
has successfully confirmed or rejected the reservation. We also have to notify
if there are no pending reservations. We will send an SMS notifying this.</p>
<p>If the reservation is <em>confirmed</em> or <em>rejected</em> we send an
additional SMS to the guest to inform the decision the host made
regarding the request made for that property reservation.</p>
<p>We use the verb <a href="//www.twilio.com/docs/api/twiml/sms/message">Message</a>
from TwiML to instruct Twilio&#39;s server that it should send the SMS
messages.</p>
</div><div data-title="Where to Next?" class="step"><h2 id="where-to-next-">Where to Next?</h2>
<p>Congrats! You just learned how to automate your workflow with Twilio SMS.</p>
<p>To improve this use case you could add anonymous communications so that the
host and guest could communicate through a private shared Twilio phone number.</p>
<p>If you&#39;re a .NET developer working with Twilio you might enjoy these
other tutorials:</p>
<p><a href="//www.twilio.com/docs/tutorials/walkthrough/ivr-phone-tree/csharp/mvc"><strong>IVR: Phone Tree</strong></a></p>
<p>Easily route callers to the right people and information with an IVR
(interactive voice response) system.</p>
<p><a href="//www.twilio.com/docs/tutorials/walkthrough/automated-survey/csharp/mvc"><strong>Automated Survey</strong></a></p>
<p>Instantly collect structured data from your users with a survey conducted
over a voice call or SMS text messages.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking out this tutorial! If you have any feedback
to share with us, we&#39;d love to hear it.
<a href="mailto:deved-oss@twilio.com">Contact the Twilio Developer Education Team</a> to let us know what you think.</p>
<p><img src="http://howtodocs.s3.amazonaws.com/airtng-screen2.png" alt="Airtng"></p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="AirTNG.Web/Domain/Reservations/TwilioMessageSender.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsKdXNpbmcgQWlyVE5HLldlYi5Eb21haW4uVHdpbGlvOwp1c2luZyBUd2lsaW87CnVzaW5nIFR3aWxpby5SZXN0LkFwaS5WMjAxMC5BY2NvdW50Owp1c2luZyBUd2lsaW8uVHlwZXM7CgpuYW1lc3BhY2UgQWlyVE5HLldlYi5Eb21haW4uUmVzZXJ2YXRpb25zCnsKICAgIHB1YmxpYyBpbnRlcmZhY2UgSVR3aWxpb01lc3NhZ2VTZW5kZXIKICAgIHsKICAgICAgICBUYXNrIFNlbmRNZXNzYWdlQXN5bmMoc3RyaW5nIHRvLCBzdHJpbmcgZnJvbSwgc3RyaW5nIGJvZHkpOwogICAgfQogICAgcHVibGljIGNsYXNzIFR3aWxpb01lc3NhZ2VTZW5kZXIgOiBJVHdpbGlvTWVzc2FnZVNlbmRlcgogICAgewogICAgICAgIHB1YmxpYyBUd2lsaW9NZXNzYWdlU2VuZGVyKCkKICAgICAgICB7CiAgICAgICAgICAgIFR3aWxpb0NsaWVudC5Jbml0KENyZWRlbnRpYWxzLkFjY291bnRTaWQsIENyZWRlbnRpYWxzLkF1dGhUb2tlbik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYXN5bmMgVGFzayBTZW5kTWVzc2FnZUFzeW5jKHN0cmluZyB0bywgc3RyaW5nIGZyb20sIHN0cmluZyBib2R5KQogICAgICAgIHsKICAgICAgICAgICAgYXdhaXQgTWVzc2FnZVJlc291cmNlLkNyZWF0ZUFzeW5jKG5ldyBQaG9uZU51bWJlcih0byksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiBuZXcgUGhvbmVOdW1iZXIoZnJvbSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiBib2R5KTsKICAgICAgICB9CiAgICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="AirTNG.Web/Models/IdentityModels.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7CnVzaW5nIFN5c3RlbS5EYXRhLkVudGl0eTsKdXNpbmcgU3lzdGVtLlNlY3VyaXR5LkNsYWltczsKdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsKdXNpbmcgTWljcm9zb2Z0LkFzcE5ldC5JZGVudGl0eTsKdXNpbmcgTWljcm9zb2Z0LkFzcE5ldC5JZGVudGl0eS5FbnRpdHlGcmFtZXdvcms7CgpuYW1lc3BhY2UgQWlyVE5HLldlYi5Nb2RlbHMKewogICAgLy8gWW91IGNhbiBhZGQgcHJvZmlsZSBkYXRhIGZvciB0aGUgdXNlciBieSBhZGRpbmcgbW9yZSBwcm9wZXJ0aWVzIHRvIHlvdXIgQXBwbGljYXRpb25Vc2VyIGNsYXNzLCBwbGVhc2UgdmlzaXQgaHR0cDovL2dvLm1pY3Jvc29mdC5jb20vZndsaW5rLz9MaW5rSUQ9MzE3NTk0IHRvIGxlYXJuIG1vcmUuCiAgICBwdWJsaWMgY2xhc3MgQXBwbGljYXRpb25Vc2VyIDogSWRlbnRpdHlVc2VyCiAgICB7CiAgICAgICAgcHVibGljIHN0cmluZyBOYW1lIHsgZ2V0OyBzZXQ7IH0KCiAgICAgICAgcHVibGljIHZpcnR1YWwgSUxpc3Q8VmFjYXRpb25Qcm9wZXJ0eT4gVmFjYXRpb25Qcm9wZXJ0aWVzIHsgZ2V0OyBzZXQ7IH0KCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8Q2xhaW1zSWRlbnRpdHk+IEdlbmVyYXRlVXNlcklkZW50aXR5QXN5bmMoVXNlck1hbmFnZXI8QXBwbGljYXRpb25Vc2VyPiBtYW5hZ2VyKQogICAgICAgIHsKICAgICAgICAgICAgLy8gTm90ZSB0aGUgYXV0aGVudGljYXRpb25UeXBlIG11c3QgbWF0Y2ggdGhlIG9uZSBkZWZpbmVkIGluIENvb2tpZUF1dGhlbnRpY2F0aW9uT3B0aW9ucy5BdXRoZW50aWNhdGlvblR5cGUKICAgICAgICAgICAgdmFyIHVzZXJJZGVudGl0eSA9IGF3YWl0IG1hbmFnZXIuQ3JlYXRlSWRlbnRpdHlBc3luYyh0aGlzLCBEZWZhdWx0QXV0aGVudGljYXRpb25UeXBlcy5BcHBsaWNhdGlvbkNvb2tpZSk7CiAgICAgICAgICAgIC8vIEFkZCBjdXN0b20gdXNlciBjbGFpbXMgaGVyZQogICAgICAgICAgICByZXR1cm4gdXNlcklkZW50aXR5OwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgY2xhc3MgQXBwbGljYXRpb25EYkNvbnRleHQgOiBJZGVudGl0eURiQ29udGV4dDxBcHBsaWNhdGlvblVzZXI+CiAgICB7CiAgICAgICAgcHVibGljIEFwcGxpY2F0aW9uRGJDb250ZXh0KCkKICAgICAgICAgICAgOiBiYXNlKCJBaXJUTkdDb25uZWN0aW9uIiwgZmFsc2UpCiAgICAgICAgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBBcHBsaWNhdGlvbkRiQ29udGV4dCBDcmVhdGUoKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBBcHBsaWNhdGlvbkRiQ29udGV4dCgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIERiU2V0PFZhY2F0aW9uUHJvcGVydHk+IFZhY2F0aW9uUHJvcGVydGllcyB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIERiU2V0PFJlc2VydmF0aW9uPiBSZXNlcnZhdGlvbnMgeyBnZXQ7IHNldDsgfQogICAgfQp9</textarea>
<textarea class="saurus-file" data-file="AirTNG.Web/Models/VacationProperty.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYzsKCm5hbWVzcGFjZSBBaXJUTkcuV2ViLk1vZGVscwp7CiAgICBwdWJsaWMgY2xhc3MgVmFjYXRpb25Qcm9wZXJ0eQogICAgewogICAgICAgIHB1YmxpYyBpbnQgSWQgeyBnZXQ7IHNldDsgfQogICAgICAgIHB1YmxpYyBzdHJpbmcgVXNlcklkIHsgZ2V0OyBzZXQ7IH0KICAgICAgICBwdWJsaWMgdmlydHVhbCBBcHBsaWNhdGlvblVzZXIgVXNlciB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIHN0cmluZyBEZXNjcmlwdGlvbiB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIHN0cmluZyBJbWFnZVVybCB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIERhdGVUaW1lIENyZWF0ZWRBdCB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIHZpcnR1YWwgSUxpc3Q8UmVzZXJ2YXRpb24+IFJlc2VydmF0aW9ucyB7IGdldDsgc2V0OyB9CiAgICB9Cn0=</textarea>
<textarea class="saurus-file" data-file="AirTNG.Web/Models/Reservation.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uQ29tcG9uZW50TW9kZWwuRGF0YUFubm90YXRpb25zLlNjaGVtYTsKCm5hbWVzcGFjZSBBaXJUTkcuV2ViLk1vZGVscwp7CiAgICBwdWJsaWMgY2xhc3MgUmVzZXJ2YXRpb24KICAgIHsKICAgICAgICBwdWJsaWMgaW50IElkIHsgZ2V0OyBzZXQ7IH0KICAgICAgICBwdWJsaWMgc3RyaW5nIE5hbWUgeyBnZXQ7IHNldDsgfQogICAgICAgIHB1YmxpYyBzdHJpbmcgUGhvbmVOdW1iZXIgeyBnZXQ7IHNldDsgfQogICAgICAgIHB1YmxpYyBSZXNlcnZhdGlvblN0YXR1cyBTdGF0dXMgeyBnZXQ7IHNldDsgfQogICAgICAgIHB1YmxpYyBzdHJpbmcgTWVzc2FnZSB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIERhdGVUaW1lIENyZWF0ZWRBdCB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIGludCBWYWN0aW9uUHJvcGVydHlJZCB7IGdldDsgc2V0OyB9CiAgICAgICAgW0ZvcmVpZ25LZXkoIlZhY3Rpb25Qcm9wZXJ0eUlkIildCiAgICAgICAgcHVibGljIHZpcnR1YWwgVmFjYXRpb25Qcm9wZXJ0eSBWYWNhdGlvblByb3BlcnR5IHsgZ2V0OyBzZXQ7IH0KICAgIH0KfQ==</textarea>
<textarea class="saurus-file" data-file="AirTNG.Web/Controllers/ReservationsController.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOwp1c2luZyBTeXN0ZW0uV2ViLk12YzsKdXNpbmcgQWlyVE5HLldlYi5Eb21haW4uUmVzZXJ2YXRpb25zOwp1c2luZyBBaXJUTkcuV2ViLk1vZGVsczsKdXNpbmcgQWlyVE5HLldlYi5Nb2RlbHMuUmVwb3NpdG9yeTsKdXNpbmcgQWlyVE5HLldlYi5WaWV3TW9kZWxzOwp1c2luZyBUd2lsaW8uVHdpTUw7CgpuYW1lc3BhY2UgQWlyVE5HLldlYi5Db250cm9sbGVycwp7CiAgICBbQXV0aG9yaXplXQogICAgcHVibGljIGNsYXNzIFJlc2VydmF0aW9uc0NvbnRyb2xsZXIgOiBDb250cm9sbGVyCiAgICB7CiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBJVmFjYXRpb25Qcm9wZXJ0aWVzUmVwb3NpdG9yeSBfdmFjYXRpb25Qcm9wZXJ0aWVzUmVwb3NpdG9yeTsKICAgICAgICBwcml2YXRlIHJlYWRvbmx5IElSZXNlcnZhdGlvbnNSZXBvc2l0b3J5IF9yZXNlcnZhdGlvbnNSZXBvc2l0b3J5OwogICAgICAgIHByaXZhdGUgcmVhZG9ubHkgSVVzZXJzUmVwb3NpdG9yeSBfdXNlcnNSZXBvc2l0b3J5OwogICAgICAgIHByaXZhdGUgcmVhZG9ubHkgSU5vdGlmaWVyIF9ub3RpZmllcjsKCiAgICAgICAgcHVibGljIFJlc2VydmF0aW9uc0NvbnRyb2xsZXIoKSA6IHRoaXMoCiAgICAgICAgICAgIG5ldyBWYWNhdGlvblByb3BlcnRpZXNSZXBvc2l0b3J5KCksCiAgICAgICAgICAgIG5ldyBSZXNlcnZhdGlvbnNSZXBvc2l0b3J5KCksCiAgICAgICAgICAgIG5ldyBVc2Vyc1JlcG9zaXRvcnkoKSwKICAgICAgICAgICAgbmV3IE5vdGlmaWVyKCkpIHsgfQoKICAgICAgICBwdWJsaWMgUmVzZXJ2YXRpb25zQ29udHJvbGxlcigKICAgICAgICAgICAgSVZhY2F0aW9uUHJvcGVydGllc1JlcG9zaXRvcnkgdmFjYXRpb25Qcm9wZXJ0aWVzUmVwb3NpdG9yeSwKICAgICAgICAgICAgSVJlc2VydmF0aW9uc1JlcG9zaXRvcnkgcmVzZXJ2YXRpb25zUmVwb3NpdG9yeSwKICAgICAgICAgICAgSVVzZXJzUmVwb3NpdG9yeSB1c2Vyc1JlcG9zaXRvcnksCiAgICAgICAgICAgIElOb3RpZmllciBub3RpZmllcikKICAgICAgICB7CiAgICAgICAgICAgIF92YWNhdGlvblByb3BlcnRpZXNSZXBvc2l0b3J5ID0gdmFjYXRpb25Qcm9wZXJ0aWVzUmVwb3NpdG9yeTsKICAgICAgICAgICAgX3Jlc2VydmF0aW9uc1JlcG9zaXRvcnkgPSByZXNlcnZhdGlvbnNSZXBvc2l0b3J5OwogICAgICAgICAgICBfdXNlcnNSZXBvc2l0b3J5ID0gdXNlcnNSZXBvc2l0b3J5OwogICAgICAgICAgICBfbm90aWZpZXIgPSBub3RpZmllcjsKICAgICAgICB9CgogICAgICAgIC8vIEdFVDogUmVzZXJ2YXRpb25zL0NyZWF0ZQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gQ3JlYXRlKGludCBpZCkKICAgICAgICB7CiAgICAgICAgICAgIHZhciB2YWNhdGlvblByb3BlcnR5ID0gYXdhaXQgX3ZhY2F0aW9uUHJvcGVydGllc1JlcG9zaXRvcnkuRmluZEFzeW5jKGlkKTsKICAgICAgICAgICAgdmFyIHJlc2VydmF0aW9uID0gbmV3IFJlc2VydmF0aW9uVmlld01vZGVsCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEltYWdlVXJsID0gdmFjYXRpb25Qcm9wZXJ0eS5JbWFnZVVybCwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uID0gdmFjYXRpb25Qcm9wZXJ0eS5EZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgIFZhY2F0aW9uUHJvcGVydHlJZCA9IHZhY2F0aW9uUHJvcGVydHkuSWQsCiAgICAgICAgICAgICAgICBWYWNhdGlvblByb3BlcnR5RGVzY3JpcHRpb24gPSB2YWNhdGlvblByb3BlcnR5LkRlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgVXNlck5hbWUgPSB2YWNhdGlvblByb3BlcnR5LlVzZXIuTmFtZSwKICAgICAgICAgICAgICAgIFVzZXJQaG9uZU51bWJlciA9IHZhY2F0aW9uUHJvcGVydHkuVXNlci5QaG9uZU51bWJlciwKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiBWaWV3KHJlc2VydmF0aW9uKTsKICAgICAgICB9CgogICAgICAgIC8vIFBPU1Q6IFJlc2VydmF0aW9ucy9DcmVhdGUKICAgICAgICBbSHR0cFBvc3RdCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBDcmVhdGUoUmVzZXJ2YXRpb25WaWV3TW9kZWwgbW9kZWwpCiAgICAgICAgewogICAgICAgICAgICBpZiAoTW9kZWxTdGF0ZS5Jc1ZhbGlkKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB2YXIgcmVzZXJ2YXRpb24gPSBuZXcgUmVzZXJ2YXRpb24KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0gbW9kZWwuTWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICBQaG9uZU51bWJlciA9IG1vZGVsLlVzZXJQaG9uZU51bWJlciwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gbW9kZWwuVXNlck5hbWUsCiAgICAgICAgICAgICAgICAgICAgVmFjdGlvblByb3BlcnR5SWQgPSBtb2RlbC5WYWNhdGlvblByb3BlcnR5SWQsCiAgICAgICAgICAgICAgICAgICAgU3RhdHVzID0gUmVzZXJ2YXRpb25TdGF0dXMuUGVuZGluZywKICAgICAgICAgICAgICAgICAgICBDcmVhdGVkQXQgPSBEYXRlVGltZS5Ob3cKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgYXdhaXQgX3Jlc2VydmF0aW9uc1JlcG9zaXRvcnkuQ3JlYXRlQXN5bmMocmVzZXJ2YXRpb24pOwogICAgICAgICAgICAgICAgcmVzZXJ2YXRpb24uVmFjYXRpb25Qcm9wZXJ0eSA9IG5ldyBWYWNhdGlvblByb3BlcnR5IHtEZXNjcmlwdGlvbiA9IG1vZGVsLlZhY2F0aW9uUHJvcGVydHlEZXNjcmlwdGlvbn07CiAgICAgICAgICAgICAgICBhd2FpdCBfbm90aWZpZXIuU2VuZE5vdGlmaWNhdGlvbkFzeW5jKHJlc2VydmF0aW9uKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiSW5kZXgiLCAiVmFjYXRpb25Qcm9wZXJ0aWVzIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsKICAgICAgICB9CgogICAgICAgIC8vIFBPU1QgUmVzZXJ2YXRpb25zL0hhbmRsZQogICAgICAgIFtIdHRwUG9zdF0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBIYW5kbGUoc3RyaW5nIGZyb20sIHN0cmluZyBib2R5KQogICAgICAgIHsKICAgICAgICAgICAgc3RyaW5nIHNtc1Jlc3BvbnNlOwoKICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHZhciBob3N0ID0gYXdhaXQgX3VzZXJzUmVwb3NpdG9yeS5GaW5kQnlQaG9uZU51bWJlckFzeW5jKGZyb20pOwogICAgICAgICAgICAgICAgdmFyIHJlc2VydmF0aW9uID0gYXdhaXQgX3Jlc2VydmF0aW9uc1JlcG9zaXRvcnkuRmluZEZpcnN0UGVuZGluZ1Jlc2VydmF0aW9uQnlIb3N0QXN5bmMoaG9zdC5JZCk7CgogICAgICAgICAgICAgICAgdmFyIHNtc1JlcXVlc3QgPSBib2R5OwogICAgICAgICAgICAgICAgcmVzZXJ2YXRpb24uU3RhdHVzID0KICAgICAgICAgICAgICAgICAgICBzbXNSZXF1ZXN0LkVxdWFscygiYWNjZXB0IiwgU3RyaW5nQ29tcGFyaXNvbi5JbnZhcmlhbnRDdWx0dXJlSWdub3JlQ2FzZSkgfHwKICAgICAgICAgICAgICAgICAgICBzbXNSZXF1ZXN0LkVxdWFscygieWVzIiwgU3RyaW5nQ29tcGFyaXNvbi5JbnZhcmlhbnRDdWx0dXJlSWdub3JlQ2FzZSkKICAgICAgICAgICAgICAgICAgICA/IFJlc2VydmF0aW9uU3RhdHVzLkNvbmZpcm1lZAogICAgICAgICAgICAgICAgICAgIDogUmVzZXJ2YXRpb25TdGF0dXMuUmVqZWN0ZWQ7CgogICAgICAgICAgICAgICAgYXdhaXQgX3Jlc2VydmF0aW9uc1JlcG9zaXRvcnkuVXBkYXRlQXN5bmMocmVzZXJ2YXRpb24pOwogICAgICAgICAgICAgICAgc21zUmVzcG9uc2UgPQogICAgICAgICAgICAgICAgICAgIHN0cmluZy5Gb3JtYXQoIllvdSBoYXZlIHN1Y2Nlc3NmdWxseSB7MH0gdGhlIHJlc2VydmF0aW9uIiwgcmVzZXJ2YXRpb24uU3RhdHVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzbXNSZXNwb25zZSA9ICJTb3JyeSwgaXQgbG9va3MgbGlrZSB5b3UgZG9uJ3QgaGF2ZSBhbnkgcmVzZXJ2YXRpb25zIHRvIHJlc3BvbmQgdG8uIjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIENvbnRlbnQoUmVzcG9uZChzbXNSZXNwb25zZSkuVG9TdHJpbmcoKSwgInRleHQveG1sIik7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBNZXNzYWdpbmdSZXNwb25zZSBSZXNwb25kKHN0cmluZyBtZXNzYWdlKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IE1lc3NhZ2luZ1Jlc3BvbnNlKCk7CiAgICAgICAgICAgIHJlc3BvbnNlLk1lc3NhZ2UobWVzc2FnZSk7CgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICAgICAgfQogICAgfQp9</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/airtng-csharp" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>